Take a look at my old SRM  module as well.



<#
$srmED =  $global:DefaultSrmServers.ExtensionData
$plans = $srmED.Recovery.ListPlans()
$plans[0].GetInfo().ProtectionGroups.GetInfo()
$srmED.Protection.ListProtectedVMs()
$groups = $srmed.Protection.ListProtectionGroups()
$groups[0].ListProtectedDatastores()
$groups[0].ListRecoveryPlans()
$groups[0].     ProtectVms  UnprotectVms    ListProtectedVms
#>



List all protection groups associated with the SRM server.

$srmApi = $srmConnection.ExtensionData
$protectionGroups = $srmApi.Protection.ListProtectionGroups()
4
Associate the TestVM virtual machine with the ProtGroup1 protection group and enable the protection for that virtual machine.

$vmToAdd = Get-VM "TestVM"

$targetProtectionGroup = $protectionGroups | where {$_.GetInfo().Name -eq "ProtGroup1" }

$targetProtectionGroup.AssociateVms(@($vmToAdd.ExtensionData.MoRef))

# Enable protection for that virtual machine
$protectionSpec = New-Object VMware.VimAutomation.Srm.Views.SrmProtectionGroupVmProtectionSpec
$protectionSpec.Vm = $vmToAdd.ExtensionData.MoRef
$protectTask = $targetProtectionGroup.ProtectVms($protectionSpec)
while(-not $protectTask.IsComplete()) { sleep -Seconds 1 }



$ed = $global:DefaultSrmServers.extensiondata
$pgs = $ed.Protection.ListProtectionGroups()
$pgs |% {
    $lo = [pscustomobject]@{
        Name = $_.GetInfo().Name  # Protection Group Name
        DataStore = $_.ListProtectedDatastores().MoRef  # Affiliated DAtastore Name(s)
    }
    $lo
}

$aps = $ed.Recovery.ListPlans()
$aps |% {
$ap = $_.GetInfo()
$ar = $ap.ProtectionGroups.ListProtectedDatastores().MoRef
if ($ap.State -match "Protecting") { $ds = (get-datastore -id $ar).Name }
else {$ds = $ar}
$lo = [pscustomobject]@{
>>         RecoverPlan = $ap.Name   # Plan Name
>>         ProtectionGroup = $ap.ProtectionGroups.GetInfo().Name
>> Datastore = $ds
>> }
>> $lo
>> }


Need to find way to search correlate datastore to protection group.  
Either a hash of all protection groups and just search it  
Or a way to grab the datastore from the VM and correlate that to the protection group.
$abc[47].ListProtectedDatastores() 
or this!!!!

$v = get-vm msfc507antv

 $eee = @{
$abc[47].ListProtectedDatastores().Moref = $abc[47]
 }

 $eee.Item($($v.ExtensionData.Datastore))

 $fff = @{}
 foreach ($a in $abc) {$fff.Add($a.ListProtectedDatastores().Moref,$a)}

$rr = get-vm uelk*
foreach ($r in $rr) {($fff.item($($r.extensiondata.datastore))).Getinfo().Name}

$abc = $srmed.Protection.ListProtectionGroups()

$abc[47]                                                                                                                    
MoRef
-----
SrmProtectionGroup-srm-vm-protection-group-184053309

Should Monitor task as shown in older SRM code

$y = [VMware.VimAutomation.Srm.Views.SrmProtectionGroupVmProtectionSpec]::new()
$y.vm=(get-vm msfc507bntv).ExtensionData.MoRef
$abc[47].ProtectVms($y)
$y.vm=(get-vm msfc507antv).ExtensionData.MoRef
$abc[47].ProtectVms($y)